// SPDX-License-Identifier: GPL-3.0

pragma solidity 0.8.10;

/**
 * @title  Asymetrix Protocol V1 BinarySearchLib
 * @author Asymetrix Protocol Inc Team
 * @notice BinarySearchLib uses binary search to find a parent contract struct
 *         with the drawId parameter.
 * @dev    The implementing contract must provider access to a struct list with
 *         is both sorted and indexed by the drawId field for binary search to
 *         work.
 */
library BinarySearchLib {
    /**
     * @notice Find ID in array of ordered IDs using Binary Search.
     * @param _history uin32[] - Array of IDsq
     * @param _drawId uint32 - Draw ID to search for
     * @return uint32 - Index of ID in array
     */
    function binarySearch(
        uint32[] storage _history,
        uint32 _drawId
    ) internal view returns (uint32) {
        uint32 index;
        uint32 leftSide = 0;
        uint32 rightSide = uint32(_history.length - 1);

        uint32 oldestDrawId = _history[0];
        uint32 newestDrawId = _history[rightSide];

        require(
            _drawId >= oldestDrawId,
            "BinarySearchLib/draw-id-out-of-range"
        );
        if (_drawId >= newestDrawId) return rightSide;
        if (_drawId == oldestDrawId) return leftSide;

        while (true) {
            uint32 length = rightSide - leftSide;
            uint32 center = leftSide + (length / 2);
            uint32 centerID = _history[center];

            if (centerID == _drawId) {
                index = center;
                break;
            }

            if (length <= 1) {
                if (_history[rightSide] <= _drawId) {
                    index = rightSide;
                } else {
                    index = leftSide;
                }
                break;
            }

            if (centerID < _drawId) {
                leftSide = center;
            } else {
                rightSide = center - 1;
            }
        }

        return index;
    }
}
